USE [UDAAN_ATS]
GO
/****** Object:  StoredProcedure [dbo].[SP_ASSET_ACQUISITION_PENDING]    Script Date: 12/4/2021 11:58:37 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[SP_ASSET_ACQUISITION_PENDING] (@ASSET_LOCATION VARCHAR(50), @DISPLAY_TYPE INT, @ASSET_CODE VARCHAR(50) = NULL)
AS 
BEGIN
	SELECT 
		'ASSET_CODE' AS [ASSET_CODE], 'ASSET_NAME' AS [ASSET_NAME], 'ASSET_DESC' AS [ASSET_DESC], 'ASSET_TYPE' AS [ASSET_TYPE], 'ASSET_LOCATION' AS [ASSET_LOCATION], 'FILE_NAME' AS [FILE_NAME]				
	UNION	
	SELECT 
		[ASSET_CODE], [ASSET_NAME], [ASSET_DESC], [ASSET_TYPE], [ASSET_LOCATION],
		--SUBSTRING(FILE_UPLOADED_PATH, LEN(FILE_UPLOADED_PATH) - CHARINDEX('\', REVERSE(FILE_UPLOADED_PATH)) + 2, LEN(FILE_UPLOADED_PATH)) [FILE_NAME]
		FILE_UPLOADED_PATH AS [FILE_NAME]
	FROM 
		[ASSET_ACQUISITION] 
	WHERE 
		ASSET_APPROVED = 4 AND ASSET_LOCATION = @ASSET_LOCATION AND ASSET_CODE = ISNULL(@ASSET_CODE, ASSET_CODE) AND
		ISNULL(FILE_UPLOADED_FLAG, 0) = @DISPLAY_TYPE
END

USE [UDAAN_ATS]
GO
/****** Object:  StoredProcedure [dbo].[SP_UPDATE_ASSET_ACQUISITION_IMAGE]    Script Date: 12/4/2021 11:59:50 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[SP_UPDATE_ASSET_ACQUISITION_IMAGE] (@ASSET_CODE VARCHAR(50), @FILEPATH VARCHAR(1000))
AS 
BEGIN
	UPDATE
		[ASSET_ACQUISITION] 
	SET		
		FILE_UPLOADED_FLAG = 1,
		FILE_UPLOADED_PATH = @FILEPATH
	WHERE 
		ASSET_APPROVED = 4 AND 
		ASSET_CODE = @ASSET_CODE 

END

